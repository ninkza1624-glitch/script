--==================================================
-- Rogue Piece | Auto Farm Anos + Skill + Equip
-- Delta Compatible
--==================================================

--================ SERVICES =================
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local PlaceId = game.PlaceId

--================ CONFIG (SAVE VIA getgenv) =================
getgenv().RP_Config = getgenv().RP_Config or {
    -- Hop
    HopMode = "Private",
    Servers = {},
    ServerIndex = 1,

    -- Timing
    WaitTime = 30,
    PublicCheckTime = 8,

    -- Move
    WarpDistance = 4,
    TweenTime = 0.25,

    -- Skill
    SkillDelay = 0.6,
    UseSkill = { Z=true, X=true, C=true, V=true },
    EquipMode = "Combat", -- Combat / Sword / Fruit

    -- State
    AutoFarm = false,
    Running = false
}
local Config = getgenv().RP_Config

--================ LOAD KAVO UI =================
local Library = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"
))()
local Window = Library.CreateLib("Rogue Piece Hub","Midnight")

--================ BOSS DETECT =================
local function GetAnos()
    for _,m in ipairs(workspace:GetDescendants()) do
        if m.Name=="Anos" and m:IsA("Model") then
            local hum = m:FindFirstChildOfClass("Humanoid")
            local hrp = m:FindFirstChild("HumanoidRootPart")
            if hum and hrp then
                return hum, hrp
            end
        end
    end
end

--================ TWEEN MOVE =================
local Tweening = false
local function TweenBehindAnos()
    if Tweening then return end
    local hum, hrp = GetAnos()
    local char = LocalPlayer.Character
    local myhrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hum or hum.Health<=0 or not hrp or not myhrp then return end

    Tweening = true
    local tween = TweenService:Create(
        myhrp,
        TweenInfo.new(Config.TweenTime, Enum.EasingStyle.Linear),
        {CFrame = hrp.CFrame * CFrame.new(0,0,Config.WarpDistance)}
    )
    tween:Play()
    tween.Completed:Wait()
    Tweening = false
end

--================ AUTO EQUIP =================
local function AutoEquip()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local bag = LocalPlayer:FindFirstChild("Backpack")
    if not char or not hum or not bag then return end

    for _,tool in ipairs(bag:GetChildren()) do
        if tool:IsA("Tool") then
            local n = tool.Name:lower()
            if Config.EquipMode=="Combat" and n:find("combat") then
                hum:EquipTool(tool) return
            elseif Config.EquipMode=="Sword" and n:find("sword") then
                hum:EquipTool(tool) return
            elseif Config.EquipMode=="Fruit" then
                hum:EquipTool(tool) return
            end
        end
    end
end

--================ AUTO ATTACK + SKILL =================
local skillIndex = 1
local skillOrder = {"Z","X","C","V"}

task.spawn(function()
    while task.wait(0.2) do
        if Config.AutoFarm then
            AutoEquip()
            TweenBehindAnos()

            local char = LocalPlayer.Character
            local tool = char and char:FindFirstChildOfClass("Tool")
            if tool then
                pcall(function() tool:Activate() end)
            end
        end
    end
end)

task.spawn(function()
    while task.wait(Config.SkillDelay) do
        if Config.AutoFarm then
            local key = skillOrder[skillIndex]
            skillIndex = skillIndex % #skillOrder + 1

            if Config.UseSkill[key] then
                local tool = LocalPlayer.Character
                    and LocalPlayer.Character:FindFirstChildOfClass("Tool")
                if tool then
                    pcall(function() tool:Activate() end)
                end
            end
        end
    end
end)

--================ PUBLIC HOP =================
local function HopPublic()
    local ok,res = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(
            "https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?limit=100"
        ))
    end)
    if ok and res and res.data and #res.data>0 then
        local s = res.data[math.random(#res.data)]
        TeleportService:TeleportToPlaceInstance(PlaceId,s.id,LocalPlayer)
    end
end

--================ AUTO HOP =================
local function StartAutoHop(Status)
    if Config.Running then return end
    Config.Running = true

    task.spawn(function()
        while Config.Running do
            local t = Config.WaitTime
            while t>0 do
                Status:UpdateLabel("‚è≥ ‡∏£‡∏≠ "..t.." ‡∏ß‡∏¥")
                task.wait(1)
                t-=1
                local hum = GetAnos()
                if hum and hum.Health>0 then
                    Status:UpdateLabel("‚öîÔ∏è ‡πÄ‡∏à‡∏≠ Anos")
                    Config.AutoFarm = true
                    while hum.Health>0 do task.wait(1) end
                    Config.AutoFarm = false
                    Status:UpdateLabel("‚ò†Ô∏è Anos ‡∏ï‡∏≤‡∏¢")
                    break
                end
            end

            Status:UpdateLabel("üîÅ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ã‡∏¥‡∏ü")
            if Config.HopMode=="Private" then
                local code = Config.Servers[Config.ServerIndex]
                Config.ServerIndex = Config.ServerIndex % #Config.Servers + 1
                TeleportService:TeleportToPrivateServer(PlaceId,code,LocalPlayer)
            else
                HopPublic()
            end
            break
        end
    end)
end

--================ UI =================
local MainTab = Window:NewTab("Main")
local Main = MainTab:NewSection("Control")
local Skill = Window:NewTab("Skill"):NewSection("Skill Toggle")

local Status = Window:NewTab("Status"):NewSection("Info")
local StatusLabel = Status:NewLabel("‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô")

Main:NewDropdown("Hop Mode","",{"Private","Public"},function(v)
    Config.HopMode=v
end)

Main:NewDropdown("Auto Equip","",{"Combat","Sword","Fruit"},function(v)
    Config.EquipMode=v
end)

Main:NewSlider("Warp Distance","",8,2,function(v)
    Config.WarpDistance=v
end)

Main:NewSlider("Skill Delay","",1,0.3,function(v)
    Config.SkillDelay=v
end)

Main:NewToggle("Auto Farm Anos","",function(v)
    if v then
        StartAutoHop(StatusLabel)
    else
        Config.AutoFarm=false
        Config.Running=false
        StatusLabel:UpdateLabel("‚è∏ ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß")
    end
end)

-- Skill Toggles
for _,k in ipairs({"Z","X","C","V"}) do
    Skill:NewToggle("Use "..k,"",function(v)
        Config.UseSkill[k]=v
    end)
end

UserInputService.InputBegan:Connect(function(i,gp)
    if not gp and i.KeyCode==Enum.KeyCode.RightShift then
        Library:ToggleUI()
    end
end)

StatusLabel:UpdateLabel("Delta Ready | RightShift ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î UI")
